---
title: "Bombus population genomics"
output: make_map.html
author: Joe Colgan, Yannick Wurm http://wurmlab.com
---

## Introduction:
The purpose of this script is to generate a map of Great Britain and highlight sampling sites.  
This script takes an input .csv file containing the information on:
1) Site identifier
2) Longitude coordinates of collection site
3) Latitude coordinates of collection site
The output of the script is an image (.png or .pdf) file.

The first step involves installing and loading libraries:

```{r, message = FALSE}
libraries <- c("ggplot2",
               "ggrepel",
               "ggspatial",
               "sf",
               "rnaturalearth",
               "rnaturalearthdata",
               "rgeos")
for (lib in libraries) {
        if (require(package = lib, character.only = TRUE)) {
                print("Successful")
        } else {
                print("Installing")
                source("https://bioconductor.org/biocLite.R")
                biocLite(pkgs = lib)
                library(lib, character.only = TRUE)
        }
}

## Save to file:
dir.create(path = "./results")
```

Load data for plotting from the world as a template background:

```{r, message = FALSE}
## Set theme:
theme_set(theme_bw())

## Load image of the world:
world <- ne_countries(scale = "medium",
                      returnclass = "sf")
world_points <- st_centroid(world)
```

For plotting of collection sites, read in input file containing coordinates:

```{r, message = FALSE}
## Read in data:
data_points <- read.csv(file = "input/map_input/input_for_maps_reduced.csv",
                        header = TRUE)
```

Generate map for Britain:

```{r, message = FALSE}
## Generate plot:
britain_map <- ggplot(data = world) +
        geom_sf() +
        geom_text(data = world_points,
                  aes(x = "Longitude",
                      y = "Latitude",
                      label = name),
                  color = "darkblue",
                  fontface = "bold",
                  check_overlap = FALSE) +
        geom_point(data = data_points,
                   aes(x = Longitude,
                       y = Latitude,
                       fill = Latitude),
                   shape = 21,
                   size = 5) +
        geom_label_repel(data = data_points,
                         aes(x = Longitude,
                             y = Latitude,
                             label = site_number_for_plots),
                         size = 4) +
        coord_sf(xlim = c(-6, 2),
                 ylim = c(57, 50),
                 expand = FALSE) +
        xlab("Longitude") +
        ylab("Latitude") +
        annotation_scale(location = "bl",
                         width_hint = 0.5) +
        theme(legend.position = "none")

## Update colour:
britain_map <- britain_map +
               theme(axis.text = element_text(size = 10,
                                              face = "plain"),
                     axis.title = element_text(size = 15,
                                               face = "bold"))
```

Save image to file:

```{r, message = FALSE}
## Assign output name to a variable:
output_file_name <- "map_of_britain"

## Create multiple image files:
for (extension in c("png",
                    "svg")) {
         ## Create output path:
         path_to_dir <- paste("results/",
                              extension,
                              "/",
                              sep = "")
         ## Create output directory:
         dir.create(path = path_to_dir,
                    recursive = TRUE)
         ## Save:
         print(output_file_name)
         ggsave(file = paste(path_to_dir,
                             output_file_name,
                             ".",
                             extension,
                             sep = ""),
                dpi = 300,
                height = 15,
                width = 10)
}

## Save image as an R object:
save(britain_map,
     file = "./results/map_of_britain.RData")
```

Run lintr:

```{r, message = FALSE}
## Run lintr:
lintr::lint(file = "./make_map.Rmd")
```

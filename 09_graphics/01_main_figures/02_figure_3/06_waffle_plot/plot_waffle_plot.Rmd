---
title: "Bombus population genomics"
output: plot_waffle_plot.html
author: Joe Colgan, Yannick Wurm http://wurmlab.com
---

## Introduction:
The following scripts takes tab-delimited text files as input and generates waffle plots:
a) Geom plots:
b) Stacked bar plot:
This script output an R object that can be used by a secondary script to generate a multi-image plot. 
This script can also output images in .png and .pdf format.  

1. Load libraries:  

```{r, message = FALSE}
library(waffle)
library(magrittr)
library(hrbrthemes)
library(ggplot2)
library(dplyr)
```

2. Load input data for plotting:

```{r, message = FALSE}
sequence_1 <- read.table(file = "input/group_counts/sequence_one_count_modified.txt",
                    header = TRUE)
sequence_1$status <- "1 (1-360)"

sequence_2 <- read.table(file = "input/group_counts/sequence_two_count_modified.txt",
                    header = TRUE)
sequence_2$status <- "2 (361-720)"

sequence_3 <- read.table(file = "input/group_counts/sequence_three_count_modified.txt",
                    header = TRUE)
sequence_3$status <- "3 (721-1140)"

sequence_4 <- read.table(file = "input/group_counts/sequence_four_count_modified.txt",
                    header = TRUE)
sequence_4$status <- "4 (1141-1289)"

## Combine sections:
combined_df <- rbind(sequence_1,
                     sequence_2,
                     sequence_3,
                     sequence_4)

## Update group names:
combined_df$group <- gsub(pattern = "_",
                          replacement = " ",
                          combined_df$group)
```

3. Generate a geom waffle plot:

```{r, message = FALSE}
## Generate waffle plot:
ggplot(combined_df,
       aes(fill = group,
           values = count)) +
        geom_waffle(color = "white",
                    size = 1.125,
                    n_rows = 6) +
        facet_wrap(~status,
                   ncol = 1) +
        scale_x_discrete(expand = c(0, 0)) +
        scale_y_discrete(expand = c(0, 0)) +
        ggthemes::scale_fill_tableau(name = NULL) +
        coord_equal() +
        theme_enhance_waffle()
```

4. Generate a stacked waffle chart:

```{r, message = FALSE}
## Generate plot:
waffle_stacked_plot <- ggplot(combined_df,
                              aes(fill = group,
                                  values = count)) +
        geom_waffle(color = "white",
                    size = .25,
                    n_rows = 10,
                    flip = TRUE) +
        facet_wrap(~status,
                   nrow = 1,
                   strip.position = "bottom") +
        scale_x_discrete() +
        scale_y_continuous(labels = function(x) x * 10,
                     expand = c(0, 0)) +
        ggthemes::scale_fill_tableau(name = NULL) +
        coord_equal() +
        labs(x = "Protein subsections (aa)",
             y = "BLASTP matches") +
  #theme_minimal(base_family = "Roboto Condensed") +
  theme_bw() +
        theme(panel.grid = element_blank(),
        axis.ticks.y = element_line(),
        axis.title = element_text(face = "bold",
                                  size = 15),
        axis.text = element_text(face = "plain",
                                 size = 10),
        legend.title = element_text(face = "bold",
                                    size = 12),
        legend.position = "bottom") +
  guides(fill = guide_legend(reverse = TRUE))

## Update colours:
waffle_stacked_plot <- waffle_stacked_plot +
        scale_fill_manual(name = "Taxonomic\ngroup",
                          values = c("steelblue1",
                                    "light blue",
                                     "orange1",
                                     "sienna3",
                                     "blue",
                                     "black"))

```

5. Save image:

```{r, message = FALSE}
save.image(file = "results/plots/wolbachia_waffle_plot.RData")
```

6. Run lintr:

```{r, message = FALSE}
lintr::lint(file = "plot_waffle_plot.Rmd")
```

---
title: "plot_admixture_results"
author: "JoeColgan"
date: "13 July 2018"
output: html_document
---

The purpose of this scripts is to take output files from the coancestry and subpopulation estimator software, ADMIXTURE and generate scatterplots. The input files are for two estimates of subpopulations (k) present within the current dataset. These estimates include:
- Cross validation error rate: the lowest CV error reat for a K in comparison to other K suggests the most appropriate
- Loglikelihood of L: This should have a correlation with CV error rate. 

```{r}
## Load libraries:
libraries <- c("devtools", "ggplot2", "ggpubr")
for (lib in libraries) {
        if (require(package = lib, character.only = TRUE)) {
                print("Successful")
        } else {
                print("Installing")
                source("https://bioconductor.org/biocLite.R")
                biocLite(pkgs = lib)
                library(lib, character.only = TRUE )
        }
}
```

Investigate and plot correction error rate:

```{r}
## Read in data for plotting of scatterplot:
admixture_data <- read.table("./complete_CV.txt", header=F)

## Subset column 3 and 4 containing information on proposed number of populations and CV error value:
admixture_data_subset <- admixture_data[,3:4]

## Reformat the third column:
admixture_data_subset$V3<- gsub('\\(K=', '', admixture_data_subset$V3)

admixture_data_subset$V3<- gsub('\\):', '', admixture_data_subset$V3)

## Rename columns and sort by K populations numerically:
admixture_data_subset_sorted<- admixture_data_subset[order(as.numeric(as.character(admixture_data_subset$V3))),]

```

Plot Correction validation error rate:

```{r}
admixture_data_subset_sorted <- subset(admixture_data, V1 <= 20)

## Rename columns:
colnames(admixture_data_subset_sorted) <- c("k", "cross_validation_error")

## Reorder levels:
admixture_data_subset_sorted$k<- factor(admixture_data_subset_sorted$k, levels = admixture_data_subset_sorted$k)

admixture_data_subset_sorted$cross_validation_error <- as.numeric(admixture_data_subset_sorted$cross_validation_error)

## Plot using ggplot:
admixture_scatterplot <- ggplot(admixture_data_subset_sorted, 
                                aes(x=admixture_data_subset_sorted$k,
                                    y=admixture_data_subset_sorted$cross_validation_error)) +
                                xlab(expression(italic("K"))) +
                                ylab("Cross validation error") +
                                geom_point(size=3) +
                                theme_minimal()

## Make axes text font bigger:
admixture_scatterplot <- admixture_scatterplot +
                         theme(axis.text=element_text(size=12),
                         axis.title=element_text(size=12,face="bold"))

## Print to console:
admixture_scatterplot
```


Plot estimated loglikelihood rate:

```{r}
## Read in log likelihood file:
loglikelihood_data <- read.table(file="./complete_loglihood.txt",
                                 header= FALSE)

## Subset to k=20:
loglikelihood_data <- subset(loglikelihood_data, V1 <= 20)

## Rename columns:
colnames(loglikelihood_data) <- c("k", "loglikelihood")

## Plot using ggplot:
loglikelihood_scatterplot <- ggplot(loglikelihood_data, 
                                aes(x=k,
                                    y=loglikelihood)) +
                                xlab(expression(italic("K"))) +
                                ylab("Estimated loglikelihood") +
                                geom_point(size=3) +
                                theme_minimal()

## Make axes text font bigger:
loglikelihood_scatterplot <- loglikelihood_scatterplot +
                                theme(axis.text=element_text(size=12),
                                axis.title=element_text(size=12,face="bold"))

## Print to console:
loglikelihood_scatterplot
```

Combine plots:

```{r}
## Combine plots:
ggarrange(admixture_scatterplot, loglikelihood_scatterplot,
          labels = c("A", "B"))

```
